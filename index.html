<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TaxAnalytics - By Nguyen Tien Duan</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Be+Vietnam+Pro:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <style>
        :root { 
            --accent: #F95211; 
            --accent-light: #FFF2ED;
            --text-main: #1A1A1A; 
            --text-sub: #64748B; 
            --blue: #0284C7; 
            --bg: #F8FAFC;
            --border: #E2E8F0;
        }

        * { box-sizing: border-box; -webkit-font-smoothing: antialiased; }

        body { 
            font-family: 'Inter', 'Be Vietnam Pro', sans-serif; 
            background: var(--bg); 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            padding: 40px 20px; 
            margin: 0; 
            color: var(--text-main);
        }

        .container { 
            background: #FFF; 
            padding: 40px; 
            border-radius: 24px; 
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.05);
            width: 100%; 
            max-width: 680px; 
            border: 1px solid var(--border);
        }

        .header { 
            display: flex; 
            flex-direction: column; 
            align-items: flex-start; 
            margin-bottom: 35px; 
            position: relative;
        }

        .brand-wrap { display: flex; flex-direction: column; }
        
        .logo-text { 
            margin: 0; 
            color: var(--accent); 
            font-weight: 800; 
            font-size: 32px; 
            letter-spacing: -1.5px;
            font-family: 'Be Vietnam Pro', sans-serif;
            line-height: 1;
        }

        .author-text {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-sub);
            margin-top: 4px;
            letter-spacing: 0.5px;
        }

        .lang-select-wrap { position: absolute; top: 0; right: 0; }
        
        .lang-select { 
            padding: 8px 12px; 
            border-radius: 10px; 
            border: 1px solid var(--border); 
            font-weight: 600; 
            font-size: 13px;
            cursor: pointer;
            outline: none;
        }

        .label-group { font-size: 11px; font-weight: 700; color: var(--text-sub); text-transform: uppercase; margin-bottom: 10px; display: block; letter-spacing: 1px; }

        .tabs { display: flex; background: #F1F5F9; border-radius: 14px; padding: 4px; gap: 4px; margin-bottom: 22px; }

        .tab-btn { 
            flex: 1; text-align: center; padding: 12px; cursor: pointer; border-radius: 10px; 
            font-weight: 600; font-size: 14px; color: var(--text-sub); border: none; background: none; transition: 0.2s; 
        }

        .tab-btn.active { background: white; color: var(--accent); box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05); }

        .f-item { margin-bottom: 22px; }
        label { font-weight: 600; font-size: 15px; display: block; margin-bottom: 8px; }

        input, select.f-input { 
            width: 100%; padding: 15px 18px; border: 1.5px solid var(--border); border-radius: 14px; 
            font-size: 17px; font-weight: 500; font-family: inherit; outline: none; transition: 0.2s;
        }

        input:focus { border-color: var(--accent); background: #FFF9F7; }

        .btn-calc { 
            width: 100%; padding: 20px; background: var(--accent); color: white; border: none; 
            border-radius: 16px; font-weight: 700; font-size: 18px; cursor: pointer; 
            text-transform: uppercase; letter-spacing: 1px; margin-top: 10px;
        }

        /* KHUNG REPORT A5 - THE SIGNATURE */
        #capture-zone { 
            display: none; width: 480px; background: white; padding: 40px; 
            border-radius: 2px; box-sizing: border-box; margin-top: 35px;
        }

        .a5-inner { border: 1.5px solid #F1F5F9; padding: 30px; border-radius: 20px; }

        .a5-header-title { text-align: center; margin-bottom: 25px; }
        .a5-main-title { color: var(--accent); font-size: 24px; font-weight: 800; margin: 0; }
        .a5-sub-title { font-size: 12px; color: var(--text-sub); font-weight: 600; margin-top: 5px; text-transform: uppercase; }

        .res-row { display: flex; justify-content: space-between; padding: 14px 0; border-bottom: 1px solid #F8FAFC; font-size: 16px; font-weight: 500; }
        
        .net-box { background: #FFF7F5; border-radius: 22px; padding: 25px; text-align: center; margin: 25px 0; border: 1px solid var(--accent-light); }
        .net-val { font-size: 40px; color: var(--accent); font-weight: 800; margin-top: 5px; }

        .comp-tag { background: #F0F9FF; border-left: 4px solid var(--blue); padding: 18px; border-radius: 14px; font-size: 14px; color: #0C4A6E; font-weight: 500; }
        .footer-note { font-size: 10px; color: #94A3B8; margin-top: 25px; text-align: center; line-height: 1.5; }

        .dl-wrap { margin-top: 25px; display: none; width: 100%; max-width: 480px; }
        .btn-dl { width: 100%; background: var(--text-main); color: white; padding: 18px; border: none; border-radius: 14px; font-weight: 600; cursor: pointer; }

        @media (max-width: 500px) {
            .container { padding: 25px; }
            .logo-text { font-size: 24px; }
            .lang-select-wrap { position: static; margin-bottom: 20px; align-self: flex-end; }
            #capture-zone { width: 100%; }
        }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <div class="brand-wrap">
            <h1 class="logo-text">TaxAnalytics</h1>
            <span class="author-text">By Nguyen Tien Duan</span>
        </div>
        <div class="lang-select-wrap">
            <select class="lang-select" onchange="updateLang(this.value)">
                <option value="vi">üáªüá≥ VI</option>
                <option value="en">üá∫üá∏ EN</option>
                <option value="kr">üá∞üá∑ KR</option>
                <option value="jp">üáØüáµ JP</option>
                <option value="cn">üá®üá≥ CN</option>
            </select>
        </div>
    </div>

    <span class="label-group" data-key="lbl_method">Ch·∫ø ƒë·ªô</span>
    <div class="tabs" id="m-tabs">
        <button class="tab-btn active" onclick="setCfg('m','G2N',this)">GROSS ‚Üí NET</button>
        <button class="tab-btn" onclick="setCfg('m','N2G',this)">NET ‚Üí GROSS</button>
    </div>

    <span class="label-group" data-key="lbl_worker">ƒê·ªëi t∆∞·ª£ng</span>
    <div class="tabs" id="w-tabs">
        <button class="tab-btn active" onclick="setCfg('w','VN',this)" data-key="btn_vn">Lao ƒë·ªông VN</button>
        <button class="tab-btn" onclick="setCfg('w','FOR',this)" data-key="btn_for">N∆∞·ªõc ngo√†i</button>
    </div>

    <span class="label-group" data-key="lbl_year">Lu·∫≠t √°p d·ª•ng</span>
    <div class="tabs" id="y-tabs">
        <button class="tab-btn active" onclick="setCfg('y',2026,this)">Lu·∫≠t 2026</button>
        <button class="tab-btn" onclick="setCfg('y',2025,this)">Lu·∫≠t 2025</button>
    </div>

    <div class="f-item">
        <label id="income-label">Thu nh·∫≠p Gross (VNƒê)</label>
        <input type="text" id="val-income" oninput="fm(this)" placeholder="Nh·∫≠p s·ªë ti·ªÅn...">
    </div>

    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
        <div class="f-item"><label data-key="lbl_dep">Ph·ª• thu·ªôc</label><input type="number" id="val-deps" value="0"></div>
        <div class="f-item"><label data-key="lbl_extra">Gi·∫£m tr·ª´ kh√°c</label><input type="text" id="val-extra" oninput="fm(this)" value="0"></div>
    </div>

    <div class="f-item">
        <label data-key="lbl_ins">L∆∞∆°ng ƒë√≥ng B·∫£o hi·ªÉm</label>
        <select class="f-input" id="ins-type" onchange="toggleIns()">
            <option value="full" data-key="opt_full">100% l∆∞∆°ng</option>
            <option value="fixed" data-key="opt_fix">M·ª©c c·ªë ƒë·ªãnh</option>
        </select>
        <input type="text" id="ins-fixed" style="display:none; margin-top:12px;" oninput="fm(this)" placeholder="Nh·∫≠p m·ª©c ƒë√≥ng...">
    </div>

    <button class="btn-calc" onclick="mainCalc()" data-key="btn_run">Ph√¢n t√≠ch k·∫øt qu·∫£</button>
</div>

<div id="capture-zone">
    <div class="a5-inner">
        <div class="a5-header-title">
            <h2 class="a5-main-title">TaxAnalytics</h2>
            <div class="a5-sub-title">By Nguyen Tien Duan</div>
        </div>
        
        <div style="width:230px; height:230px; margin: 0 auto 20px;"><canvas id="myChart"></canvas></div>
        
        <div class="res-row"><span data-key="res_gross">L∆∞∆°ng Gross</span><b id="res-g"></b></div>
        <div class="res-row"><span id="res-bh-lbl">B·∫£o hi·ªÉm</span><b id="res-b"></b></div>
        <div class="res-row"><span data-key="res_tax">Thu·∫ø TNCN</span><b id="res-t" style="color:var(--blue)"></b></div>
        
        <div class="net-box">
            <div style="font-size: 11px; font-weight: 700; color: var(--text-sub); text-transform: uppercase; letter-spacing: 1px;" data-key="lbl_net_res">Th·ª±c nh·∫≠n (NET)</div>
            <div class="net-val" id="res-n"></div>
        </div>
        
        <div class="comp-tag" id="res-c"></div>
        <div class="footer-note" data-key="legal_txt">...</div>
    </div>
</div>

<div class="dl-wrap" id="dl-wrap"><button class="btn-dl" onclick="takeShot()" data-key="btn_jpg">T·∫£i B√°o C√°o (JPG)</button></div>

<script>
    // Logic d·ªãch thu·∫≠t v√† t√≠nh to√°n gi·ªØ nguy√™n 100% ƒë·ªô ch√≠nh x√°c
    const langDB = {
        vi: { lbl_method:"Ch·∫ø ƒë·ªô t√≠nh", btn_vn:"Lao ƒë·ªông VN", btn_for:"N∆∞·ªõc ngo√†i", lbl_income_g:"Thu nh·∫≠p Gross", lbl_income_n:"Thu nh·∫≠p Net", lbl_dep:"Ph·ª• thu·ªôc", lbl_extra:"Gi·∫£m tr·ª´ kh√°c", lbl_ins:"B·∫£o hi·ªÉm", opt_full:"100% l∆∞∆°ng", opt_fix:"M·ª©c c·ªë ƒë·ªãnh", btn_run:"Ph√¢n t√≠ch k·∫øt qu·∫£", res_gross:"L∆∞∆°ng Gross", res_tax:"Thu·∫ø TNCN", lbl_net_res:"TH·ª∞C NH·∫¨N (NET)", btn_jpg:"T·∫£i B√°o C√°o (JPG)", legal_txt:"D·ªØ li·ªáu d·ª±a tr√™n bi·ªÉu thu·∫ø l≈©y ti·∫øn 7 b·∫≠c. SI tr·∫ßn 46.8tr VNƒê.", comp_pre:"So v·ªõi nƒÉm", save:"Ti·∫øt ki·ªám", pay:"N·ªôp th√™m" },
        en: { lbl_method:"Mode", btn_vn:"VN Staff", btn_for:"Expats", lbl_income_g:"Gross Income", lbl_income_n:"Net Income", lbl_dep:"Dependents", lbl_extra:"Other Deduct", lbl_ins:"Insurance", opt_full:"Full Salary", opt_fix:"Fixed Base", btn_run:"Analyze Results", res_gross:"Gross Salary", res_tax:"PIT Tax", lbl_net_res:"NET TAKE-HOME", btn_jpg:"Download JPG", legal_txt:"Based on 7-level progressive tax. SI cap 46.8M VND.", comp_pre:"Vs", save:"Saved", pay:"Pay more" },
        kr: { lbl_method:"Í≥ÑÏÇ∞ Î™®Îìú", btn_vn:"Î≤†Ìä∏ÎÇ®Ïù∏", btn_for:"Ïô∏Íµ≠Ïù∏", lbl_income_g:"Ï¥ù Í∏âÏó¨", lbl_income_n:"Ïã§ÏàòÎ†πÏï°", lbl_dep:"Î∂ÄÏñëÍ∞ÄÏ°±", lbl_extra:"Í∏∞ÌÉÄ Í≥µÏ†ú", lbl_ins:"Î≥¥ÌóòÎ£å", opt_full:"Í∏âÏó¨ 100%", opt_fix:"Í≥†Ï†ï Í∏àÏï°", btn_run:"Í≤∞Í≥º Î∂ÑÏÑù", res_gross:"Ï¥ù Í∏âÏó¨", res_tax:"Í∞úÏù∏ÏÜåÎìùÏÑ∏", lbl_net_res:"Ïã§ÏàòÎ†πÏï° (NET)", btn_jpg:"JPG Ï†ÄÏû•", legal_txt:"7Îã®Í≥Ñ ÎàÑÏßÑÏÑ∏ Í∏∞Ï§Ä. ÏÇ¨ÌöåÎ≥¥Ìóò ÏÉÅÌïú 4680Îßå.", comp_pre:"ÎåÄÎπÑ", save:"Ï†àÍ∞ê", pay:"Ï∂îÍ∞ÄÎÇ©Î∂Ä" },
        jp: { lbl_method:"Ë®àÁÆó„É¢„Éº„Éâ", btn_vn:"„Éô„Éà„Éä„É†‰∫∫", btn_for:"Â§ñÂõΩ‰∫∫", lbl_income_g:"Á∑èÊîØÁµ¶È°ç", lbl_income_n:"ÊâãÂèñ„ÇäÈ°ç", lbl_dep:"Êâ∂È§äÂÆ∂Êóè", lbl_extra:"„Åù„ÅÆ‰ªñÊéßÈô§", lbl_ins:"Á§æ‰ºö‰øùÈô∫", opt_full:"Áµ¶‰∏é„ÅÆ100%", opt_fix:"Âõ∫ÂÆöÈ°ç", btn_run:"ÂàÜÊûê„ÇíÂÆüË°å", res_gross:"Á∑èÊîØÁµ¶È°ç", res_tax:"ÊâÄÂæóÁ®é", lbl_net_res:"ÊâãÂèñ„ÇäÈ°ç (NET)", btn_jpg:"JPG„Çí‰øùÂ≠ò", legal_txt:"7ÊÆµÈöéÁ¥ØÈÄ≤Á®éÁéá„ÄÇÁ§æ‰ºö‰øùÈô∫‰∏äÈôê4680‰∏á„ÄÇ", comp_pre:"„Å®ÊØîËºÉ", save:"ÁØÄÁ®é", pay:"ËøΩÂä†Âæ¥Âèé" },
        cn: { lbl_method:"ËÆ°ÁÆóÊ®°Âºè", btn_vn:"Ë∂äÂçóÁ±ç", btn_for:"Â§ñÁ±ç", lbl_income_g:"ÊÄªËñ™ËµÑ", lbl_income_n:"ÂáÄËñ™ËµÑ", lbl_dep:"ÊäöÂÖª‰∫∫Êï∞", lbl_extra:"ÂÖ∂‰ªñÊâ£Èô§", lbl_ins:"Á§æ‰ºö‰øùÈô©", opt_full:"100%ÂÖ®È¢ù", opt_fix:"Âõ∫ÂÆöÂü∫Êï∞", btn_run:"Êü•ÁúãÂàÜÊûê", res_gross:"ÊÄªÂ∑•ËµÑ", res_tax:"‰∏™‰∫∫ÊâÄÂæóÁ®é", lbl_net_res:"ÂÆûÂèëÂ∑•ËµÑ (NET)", btn_jpg:"‰øùÂ≠òÊä•Âëä", legal_txt:"7Á∫ßÁ¥ØËøõÁ®éÁéá„ÄÇ‰øùÈô©‰∏äÈôê4680‰∏á„ÄÇ", comp_pre:"‰∏éÂéªÂπ¥Áõ∏ÊØî", save:"ËäÇÁúÅ", pay:"Ë°•Áº¥" }
    };

    let cfg = { m: 'G2N', w: 'VN', y: 2026, l: 'vi' };
    let chart = null;
    Chart.register(ChartDataLabels);

    function updateLang(l) {
        cfg.l = l;
        document.querySelectorAll('[data-key]').forEach(e => e.innerText = langDB[l][e.dataset.key] || e.innerText);
        document.getElementById('income-label').innerText = cfg.m === 'G2N' ? langDB[cfg.l].lbl_income_g : langDB[cfg.l].lbl_income_n;
    }

    function setCfg(k, v, btn) {
        document.getElementById(btn.parentNode.id).querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        cfg[k] = v;
        if(k === 'm') updateLang(cfg.l);
    }

    function fm(i) { let v = i.value.replace(/\D/g, ""); i.value = v ? Number(v).toLocaleString('en-US') : ""; }
    function pV(id) { return parseFloat(document.getElementById(id).value.replace(/,/g, "")) || 0; }
    function toggleIns() { document.getElementById('ins-fixed').style.display = document.getElementById('ins-type').value === 'fixed' ? 'block' : 'none'; }

    function getPIT(ti) {
        if (ti <= 0) return 0;
        if (ti <= 5000000) return ti * 0.05;
        if (ti <= 10000000) return ti * 0.1 - 250000;
        if (ti <= 18000000) return ti * 0.15 - 750000;
        if (ti <= 32000000) return ti * 0.2 - 1650000;
        if (ti <= 52000000) return ti * 0.25 - 3250000;
        if (ti <= 80000000) return ti * 0.3 - 5850000;
        return ti * 0.35 - 9850000;
    }

    function calculate(gross, year, worker, deps, extra, insType, insFix) {
        const ceiling = 46800000;
        const bhRate = (worker === 'VN') ? 0.105 : 0.095;
        const bhBase = (insType === 'full') ? gross : insFix;
        const bh = Math.min(bhBase, ceiling) * bhRate;
        const selfGT = (year === 2026) ? 15500000 : 11000000;
        const depGT = (year === 2026) ? 6200000 : 4400000;
        const ti = Math.max(0, gross - bh - selfGT - (deps * depGT) - extra);
        return { bh, tax: getPIT(ti), net: gross - bh - getPIT(ti), bhRate };
    }

    function mainCalc() {
        const val = pV('val-income'); if(!val) return;
        const deps = pV('val-deps'), extra = pV('val-extra'), it = document.getElementById('ins-type').value, ifx = pV('ins-fixed');
        
        let finalGross = val;
        if (cfg.m === 'N2G') {
            let low = val, high = val * 2;
            for (let i = 0; i < 50; i++) {
                let mid = (low + high) / 2;
                if (calculate(mid, cfg.y, cfg.w, deps, extra, it, ifx).net < val) low = mid;
                else high = mid;
            }
            finalGross = high;
        }

        const r = calculate(finalGross, cfg.y, cfg.w, deps, extra, it, ifx);
        const f = n => Math.round(n).toLocaleString('en-US') + ' ƒë';

        document.getElementById('res-g').innerText = f(finalGross);
        document.getElementById('res-bh-lbl').innerText = (cfg.l === 'vi' ? 'B·∫£o hi·ªÉm' : 'Insurance') + ` (${(r.bhRate*100).toFixed(1)}%)`;
        document.getElementById('res-b').innerText = f(r.bh);
        document.getElementById('res-t').innerText = f(r.tax);
        document.getElementById('res-n').innerText = f(r.net);
        
        let oy = cfg.y === 2026 ? 2025 : 2026;
        let c = calculate(finalGross, oy, cfg.w, deps, extra, it, ifx);
        let diff = Math.abs(r.tax - c.tax);
        let status = r.tax < c.tax ? langDB[cfg.l].save : langDB[cfg.l].pay;
        document.getElementById('res-c').innerHTML = `üí° ${langDB[cfg.l].comp_pre} <b>${oy}</b>: ${langDB[cfg.l].res_tax} <b>${f(c.tax)}</b>. ${status}: <b>${f(diff)}</b>.`;
        
        updateChart(r.net, r.tax, r.bh);
        document.getElementById('capture-zone').style.display = 'block';
        document.getElementById('dl-wrap').style.display = 'block';
    }

    function updateChart(n, t, b) {
        const ctx = document.getElementById('myChart').getContext('2d');
        if (chart) chart.destroy();
        chart = new Chart(ctx, {
            type: 'doughnut',
            data: { labels: ['Net', 'Tax', 'Ins'], datasets: [{ data: [n, t, b], backgroundColor: ['#F95211', '#0284C7', '#1A1A1A'], borderWidth: 0 }] },
            options: { cutout: '75%', animation: { duration: 800 }, plugins: { legend: { display: false }, datalabels: { color: '#fff', font: { weight: '800', size: 12 }, formatter: (v) => (v/1000000).toFixed(1) + 'M' } } }
        });
    }

    function takeShot() {
        html2canvas(document.getElementById('capture-zone'), { scale: 3 }).then(canvas => {
            const link = document.createElement('a');
            link.download = `TaxAnalytics_NguyenTienDuan.jpg`;
            link.href = canvas.toDataURL("image/jpeg", 0.95);
            link.click();
        });
    }
    updateLang('vi');
</script>
</body>
</html>
